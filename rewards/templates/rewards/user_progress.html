{% extends "base.html" %}
{% load static %}

{% block title %}My Progress & Rewards{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row">
        <div class="col-12 text-center mb-5">
            <h1 class="hush-hub-title">My Progress Dashboard</h1>
            <p class="lead text-muted">
                {{ request.user.user_ld|default:"Welcome, Friend!" }} - Track your self-care journey.
            </p>

            <a href="{% url 'rewards:leaderboard' %}" class="btn btn-outline-primary mt-3">View Leaderboard üèÜ</a>
        </div>
    </div>

    <div class="row mb-5 justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm p-4 border-0">
                {% if progress %}
                    <h4 class="card-title">Current Level: <span class="badge bg-primary">{{ progress.current_level }}</span></h4>
                    <p class="text-muted">Total XP: {{ progress.total_xp }}</p>

                    {% with required_xp=1000 %}
                        {% if progress.total_xp < required_xp %}

                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar progress-bar-striped bg-success"
                                     role="progressbar"
                                     style="width: {{ progress.total_xp }}px;"
                                     aria-valuenow="{{ progress.total_xp }}"
                                     aria-valuemin="0"
                                     aria-valuemax="{{ required_xp }}">

                                    {{ progress.total_xp }}/{{ required_xp }} XP
                                </div>
                            </div>

                            <small class="text-muted mt-2">You need more XP for Level {{ progress.current_level|add:1 }}.</small>

                        {% else %}
                            <p class="text-success fw-bold">Congratulations! You are ready for the next level.</p>
                        {% endif %}

                    {% endwith %}
                {% else %}
                    <p class="text-muted">Start your first self-care task or post to begin tracking your progress.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 mb-4">
            <h3>üèÖ Earned Badges ({{ user_badges|length }})</h3>
        </div>
    </div>

    <div class="row">
        {% for user_badge in user_badges %}
        <div class="col-6 col-md-4 col-lg-3 mb-4">
            <div class="card h-100 text-center border-0 shadow-sm badge-card">
                <div class="card-body">
                    <img src="{{ user_badge.badge.icon_url }}"
                         alt="{{ user_badge.badge.name }} Badge"
                         class="img-fluid mb-2"
                         style="width: 80px; height: 80px; object-fit: cover;">

                    <h5 class="card-title text-primary">{{ user_badge.badge.name }}</h5>
                    <p class="card-text text-muted small">{{ user_badge.badge.description }}</p>
                    <small class="text-success">Earned: {{ user_badge.achieved_at|date:"d M, Y" }}</small>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="alert alert-info" role="alert">
                You haven't earned any badges yet. Get started and add the first badge to your collection!
            </div>
        </div>
        {% endfor %}
    </div>

</div>

<style>
    .hush-hub-title {
        color: #E91E63;
    }
    .bg-hush-gold {
        background-color: #FFC107 !important;
        border-color: #FFC107 !important;
    }
    .badge-card img {
        border-radius: 50%;
        border: 3px solid #E91E63;
        padding: 5px;
    }
</style>
{% endblock %}